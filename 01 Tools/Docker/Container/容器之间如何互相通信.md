# 容器之间如何互相通信

现在我有一个golang-hrl的docker容器用来跑golang服务，然后我还有一个mysql-test的docker容器来跑mysql。

现在我希望golang-hrl中的golang服务能够调用mysql-test中的mysql服务

应该怎么做呢？

## 直接通过docker的虚拟网络地址和主机端口来访问

我本机上mysql-test容器的ip是`172.17.0.3`
golang-hrl容器的ip是`172.17.0.2`
发现这两个容器的ip是同一个网段，那么就可以ping通，然后

mysql-test可以直接使用容器开放的接口来访问：

```bash
curl --get 172.17.0.2:8080/version
```

golang-hrl容器也可以使用ip来访问mysql-test容器中的mysql服务

## 容器间通信的常见方式

1. **同一网络（bridge或自定义network）**：容器在同一个Docker网络下，可以通过容器名互相访问。
2. **端口映射（-p）**：容器服务端口映射到主机，其他容器通过主机IP访问。
3. **--link（已过时）**：早期Docker提供的容器互联方式，现在推荐用自定义网络。
4. **docker-compose**：多容器编排，自动在同一网络下，服务名即为主机名。

> 推荐做法：自定义网络，容器间可直接用容器名通信，无需暴露端口到主机。

---

## 实现golang-hrl访问mysql-test的步骤 by GhatGPT

### 步骤1：创建自定义网络
```bash
docker network create mynet
```

### 步骤2：启动MySQL容器并加入网络
```bash
docker run -itd --name mysql-test --network mynet -e MYSQL_ROOT_PASSWORD=123456 mysql
```

### 步骤3：启动Golang容器并加入同一网络
假设你已有镜像`golang-hrl`，可以这样启动：
```bash
docker run -itd --name golang-hrl --network mynet golang-hrl
```

### 步骤4：在Golang代码中配置MySQL连接
连接字符串示例（host用mysql-test替代IP）：
```go
dsn := "root:123456@tcp(mysql-test:3306)/your_dbname"
db, err := sql.Open("mysql", dsn)
```

### 步骤5：测试连接
进入golang-hrl容器，ping mysql-test或用mysql客户端测试：
```bash
docker exec -it golang-hrl bash
ping mysql-test
# 或
mysql -h mysql-test -P 3306 -u root -p123456
```

---

## 参考要点
- 容器在同一自定义网络下，可以直接用容器名作为主机名访问服务。
- 不需要暴露MySQL端口到主机，只需让golang-hrl和mysql-test在同一网络。
- 连接字符串示例：`user:password@tcp(mysql-test:3306)/dbname`

---

## 相关文章
- [官方文档：Docker 网络](https://docs.docker.com/network/)
- [Docker 容器互相通信的几种方式](https://segmentfault.com/a/1190000022329565)
- [Docker Compose 容器互通](https://docs.docker.com/compose/networking/)
- [Golang 连接 Docker 内的 MySQL](https://stackoverflow.com/questions/25570957/how-to-connect-to-mysql-database-from-inside-docker-container)
