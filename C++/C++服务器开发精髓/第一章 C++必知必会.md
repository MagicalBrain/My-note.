# 第一章 C++必知必会

## 什么是RAII

先看个例子：
刚学习服务器开发，一般都会有的一个练习：
在Windows上写一个C++程序，用该程序实现一个简单的服务，在客户端链接上来的时候，给客户端发一条"hello, world!"消息后关闭连接，不用保证客户端一定能收到。

这个程序其实描述的就是TCP网络通信的基本原理，其实现流程如下：

1. 创建socket
2. 绑定IP地址和端口号
3. 在该IP地址和端口号上启动监听，循环等待客户端连接的到来，在客户端连接后，向其发送一条"Hello, World!"消息，然后断开连接。

**注意**：
1. 在win上使用网络通信接口之前，需要用WSAStartup函数初始化socket库；
2. 在程序结束后需要使用WSACleanup函数清理socket库。

咱应当能够快速地写出来。

### 版本一
@import "./code/winsocketDemo.cpp"

备注：
这代码直接在VS里新建一个解决方案放里面就能运行。

以上这代码虽然满足了要求，但是有些地方不太令人满意，因为代码中充斥着用于避免出错的重复资源清理逻辑：

```cpp
closesocket(sockSrv);
WSACleanup();
```

我们可以将上述场景理解为：“先分配资源，再进行相关操作，在任意中间步骤出错的时候都对相应的资源进行回收。”
但这样编写代码太容易出错了。

### 版本二

用`goto`语句改进版本一的代码

@import "./code/winsocketDemo-2.cpp"

### 版本三

使用goto不是一个好的习惯，那用`do-while`语句来改写版本二的代码

### 版本四

RAII惯用写法是比`do-while`写法更好的。

RAII机制（资源获取即初始化， ResourceAcquisition Is Initialization）

所谓RAII的目的很简单，其实就是通过定义类、使用类来实现：
资源在拿到的时候就已经初始化，一旦不需要资源了就自动释放。


