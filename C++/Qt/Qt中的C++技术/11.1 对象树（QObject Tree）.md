# 11.1 对象树（QObject Tree）

Qt库中很多类都以QObject作为它们的基类。
Qt中所有的控件类都是以QObject作为基类的。

QObject对象总是以树状结构组织自己。
其特性有：
创建新对象时可以指定其父对象，此时新对象就会被加入到父对象的子对象列表中。
当父对象被析构时，这个列表中所有的子对象都会被析构；
当该对象被析构时，它会从父对象的子对象列表中删除，以避免父对象析构时再次析构它从而造成错误。

由于QObject对象具有上述析构功能，所以当我们==使用new操作符在堆中创建QObject对象==时，并不需要使用delete操作符析构它们。
当一个QObject对象的父对象被析构时，该对象会被自动析构。
当我们显式析构某个QObject对象时，其父对象也会在子对象列表中将其删除。

然而当我们==以局部变量的方式在栈中定义QObject对象时==，应该先定义父对象，再定义子对象。

例如：
```cpp
int main() {
    QPushButton button("OK");
    QDialog dialog;
    button.setParent(&dialog);
    // ...
    return 0;
}
```

这样的程序是会触发异常的。
因为依据C++规范，程序结束的时候时会先析构dialog，再析构button的。
但是析构dialog的时候，button已经被析构了，这就会导致button析构两次，程序会异常退出。

将上面的代码改成：
```cpp
int main() {
    QDialog dialog;
    QPushButton button("OK");
    button.setParent(&dialog);
    // ...
    return 0;
}
```
程序才可以正常运行

总之，我们尽量在堆中创建QObject对象，即尽量多使用new来创建QObject对象。
如果要在栈中创建，那一定要注意QObject对象的定义顺序。
