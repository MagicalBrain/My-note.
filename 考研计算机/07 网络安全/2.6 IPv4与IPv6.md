# IPv4与IPv6

[toc]

## IPv4

### 什么是IPv4？

是网际协议IP的第四个版本。

### IPv4数据包的格式

### IPv4上是如何打通IPv6隧道的？（方式有哪些？）

首先我们得理解，IPv6目前还没有得倒广泛的应用，很多设备使用的还是IPv4协议，那如果要让这些设备接受IPv6的数据怎么办？

就需要在IPv4的防火墙上开出一条接收的通道（隧道）。

开通隧道的方法（所使用的协议）主要有：

1. 6to4
2. 6over4
3. Teredo（3544UDP端口）

## IPv6

### 什么是IPv6？

IP协议的一个版本，目前投入使用的最新版本，是IPv4的下一代，IPv1、2、3、5未曾使用过。

### IPv6数据包的格式

### IPv6的新特性

1. 简单即美：
   1. 简化固定报头，提高处理效率
2. 扩展为先：
   1. 引入灵活的扩展报头，增加了IPv6的扩展性
3. 层次地址：
   1. IPv6的地址格式更具层次性，便于路由聚合
4. 即插即用：
   1. IPv6地址配置简单，而且支持自动配置
5. 内嵌安全机制：
   1. 内嵌IPsec安全机制，支持地址认证保密传输等安全功能
6. 增强QoS（服务质量）：
   1. IPv6新增了流标识字段，用于QoS服务质量控制
7. 移动便捷：
   1. 更好地解决了移动IP路由的问题

### IPv6的安全改进

1. 跳数限制取代了TTL
2. 省掉了校验和
3. 去掉了分端字段
4. 删除头部可选项

### IPv6可能会引进的风险

1、IPv6地址引入的风险

2、IPv6报文格式引入的风险

1. 大量畸形的IPv6数据包可能会极大地耗费网络节点的处理能力，造成DOS攻击
2. 通过错误设置扩展报头中的下一报头（）或者报头长度字段的值，使其错误地标识下一个扩展报头的类型和长度，这有可能导致网络设备处理故障
3. 路由设备可能在忽略或者丢弃错误的数据包的时候，同时发送一个ICMPv6报文将错误信息通告给数据源引发DOS攻击
4. 逐跳选项报头是一种特殊的扩展报头，因为所有转发含此报头的数据包的中间路由设备，均会处理选项报头中的选项内容。如果将攻击信息设置到选项内容中，那么转发路径上的所有路由设备都将遭受攻击，因此这是一种具有放大效应的攻击方式。
5. 利用IPv6扩展报头中的路由选项报头的安全漏洞，可能出现外部攻击者故意构造带有路由报头的数据包，将DMZ区服务器作为中转，以绕过边界的安全设备直接对内部主机发起攻击

3、IPv6协议族中部分协议引入的风险

1. 消息伪造
2. 恶意篡改
3. DOS攻击
4. 对上层协议的攻击

## IPv4与IPv6数据包格式的区别

1、地址位数不同

IPv4是32位的，IPv6则是128位的