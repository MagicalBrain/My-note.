# 4.2

## 选择题

#### 1、下列文件物理结构中，适合随机访问且易于文件扩展的是？

A、连续结构
B、索引结构
C、链式结构且磁盘块定长
D、链式结构且磁盘块变长

正解：B

解析：
连续结构中磁盘块不能定长；
链式结构无法随机访问；
索引结构的特性就是**随机访问**、**易于扩展**

#### 2、设文件索引结点中有7个地址项，其中4个是直接地址索引、2个一级间接索引、1个二级间接索引。每个地址块大小为4B，若磁盘块和磁盘数据块的大小均为256B，则单个文件最长长度为？

A、33KB
B、519KB
C、1057KB
D、16516KB

正解：C

解析：
4个直接地址索引指向的数据块大小：
$$4 \times 256B = 1KB$$
一个一级间接索引指向的数据块个数：$\frac{256}{4} = 64$
2个一级间接索引指向的数据块大小：
$$2 \times \frac{256}{4} \times 256B = 2\times 64 \times 256B = 32KB$$
二级地址索引指向的数据块数量：$(\frac{256}{4})^2 =64^2$
二级地址索引指向的数据块大小：
$$(\frac{256}{4})^2 \times 256B = 1024KB$$
总的：
$$1KB + 32KB + 1024KB = 1057KB$$
故选C

#### 3、以下不适合直接存取的外存分配方式是？

A、连续分配
B、链接分配
C、索引分配
D、以上都适合

正解：B

解析：
**直接存取即随机存取**，只有链接分配不适合随机存取，故选B

#### 5、为支持CD-ROM中视频文件的快速随机播放，播放性能最好的文件数据块组织方案是？

A、连续结构
B、链式结构
C、直接索引结构
D、多层索引结构

正解：A

解析：
要满足快速随机播放，首先可以排除链式，因为其不支持随机存取；又因为要快速，即快速查询，就只有连续结构可以满足了
故选A

#### 10、文件系统采用两级索引分配方式，若每个磁盘块的大小为1KB，每个盘块号占4B，则该系统中，单个文件的最大长度是？

A、64MB
B、128MB
C、32MB
D、以上答案都不对

正解：A

解析：
每个磁盘块的索引块数量最大为：$\frac{1K}{4} = 256$个
每个索引都是二级索引，故其所指向的数据块大小为：$$(\frac{1K}{4})^2 \times 1KB = 64MB$$
故选A

#### 12、一个文件系统中，其FCB占64B，一个盘块大小为1KB，采用一级目录，假定文件目录中有3200个目录项。则查找一个文件平均需要访问？次磁盘

A、50
B、54
C、100
D、200

正解：C

解析：
3200个目录项占用的盘块数为：$\frac{3200 \times 64}{1KB} = 200$个
平均访问次数为：$\frac{200}{2} = 100$

#### 14、文件的存储空间管理实质上是对（）的组织和管理。

A.文件目录
B.外存已占用区域
C.外存空闲区
D.文件控制块

14.C
文件存储空间管理即文件空闲空间管理。文件管理要解决的重要问题是，如何为创建文件分配存储空间，即如何找到空闲盘块，并对其管理。

#### 15、若用8个字（字长为32位）组成的位示图图管理内存，假定用户归还一个块号为100的内存块时，它对应的位示图的位置为？

A、字号为3，位号为5
B、字号为4，位号为4
C、字号为3，位号为4
D、字号为4，位号为5

正解：B

解析：
字号（行号）：$$(100 - 1) \div 32 + 1 = 4$$
位号（列号）：$$(100 - 1) \% \ 32 + 1 = 4$$

#### 16、设有一个文件夹，采用链接分配方式，逻辑记录的固定长度为100B，在磁盘上存储时采用记录成组分解技术。盘块长为512B。若该文件的目录项已经读入内存，则对第22个逻辑记录完成修改后，共启动了？次磁盘

A、3
B、4
C、5
D、6

正解：D

解析：
第22个逻辑块对应的磁盘块号为：$\frac{22 \times 100}{512} = 4 \cdots 152$
读取启动次数为$4+1=5$
又因为修改还要再启动一次，故$5+1=6$次
选D

#### 20、在文件的索引结点中存放直接索引指针10个，一级和二级索引指针各一个，磁盘块大小为1KB，每个索引指针占4B。若某文件的索引结点已在内存中，则把该文件偏移量（按字节编址）为1234和307400处所在的磁盘块读入内存，需访问的磁盘块个数为？

A、1，2
B、1，3
C、2，3
D、2，4

正解：B

解析：
10个直接索引指向的数据块大小为：$10 \times 1KB = 10KB$
又因为偏移量1234小于10K，故访问个数为1
一级索引指针指向数据块大小为：$\frac{1K}{4} \times 1KB = 256KB$
又因为偏移量307400大于256K，故访问个数为$2+1=3$
故选B

#### 21、文件系统用位图法表示磁盘空间的分配情况，位图存于磁盘的32～127号块中，每个盘块和块内字节均从0开始编号，假设要释放的盘块号为409612，则位图中要修改的位所在的盘块号和块内字节序号分别是？

A、81，1
B、81，2
C、82，1
D、82，2

正解：C

解析：
$修改位所在的盘块号=起始块号 + \frac{盘块号}{1024 \times 8} = 32 + 50 = 82$

块内字节号（不是位号）：$盘块号\ \%\ (1024 \times 8) \div 8 = 1$

#### 22、【2019统考真题】下列选项中，可用于文件系统管理空闲磁盘块的数据结构是（）

I.位图
II.索引结点
III.空闲磁盘块链
IV.文件分配表（AT）

A.仅I、II
B.仅I、III、IV
C.仅I、III
D.仅II、III、IV

22.B
传统文件系统管理空闲磁盘的方法包括空闲表法、空闲链表法、位示图法和成组链接法，I、III正确。
文件分配表（FAT）的表项与物理磁盘块一一对应，并且可以用一个特殊的数字-1表示文件的最后一块，用-2表示这个磁盘块是空闲的（当然，规定用-3，-4来表示也是可行的）。因此文件分配表（FAT）不仅记录了文件中各个块的先后链接关系，同时还标记了空闲的磁盘块，操作系统可以通过FAT对文件存储空间进行管理，IV正确。
索引结点是操作系统为了实现文件名与文件信息分开而设计的数据结构，存储了文件描述信息，索引结点属于文件目录管理部分的内容，II错误。

## 综合题

#### 1.简述文件的外存分配中，连续分配、链接分配和索引分配各自的主要优缺点。

#### 2.在实现文件系统时，为加快文件目录的检索速度，可利用“FCB分解法”。假设目录文件存放在磁盘上，每个盘块512B.FCB占64B，其中文件名占8B通常将FCB分解成两部分，第一部分占10B（包括文件名和文件内部号），第二部分占56B（包括文件内部号和文件的其他描述信息）。
1）假设某一目录文件共有254个FCB，试分别给出采用分解法前和分解法后，查找该目录文件的某个FCB的平均访问磁盘次数。
2）一般地，若目录文件分解前占用n个盘块，分解后改用m个盘块存放文件名和文件内部号，请给出访问磁盘次数减少的条件。

#### 3.设某文件为链接文件，由5个逻辑记录组成，每个逻辑记录的大小与磁盘块的大小相等，均为512B，并依次存放在50，121，75，80，63号磁盘块上。若要存取文件的第1569逻辑字节处的信息，要访问哪个磁盘块？

#### 4.【2011统考真题】某文件系统为一级目录结构，文件的数据一次性写入磁盘，已写入的文件不可修改，但可多次创建新文件。请回答如下问题。
1）在连续、链式、索引三种文件的数据块组织方式中，哪种更合适？说明理由。为定位
文件数据块，需要在FCB中设计哪些相关描述字段？
2）为快速找到文件，对于FCB，是集中存储好，还是与对应的文件数据块连续存储好？
说明理由。

#### 5.假定磁盘块的大小为1KB，对于540MB的硬盘，其文件分配表（FAT）最少需要占用多少存储空间？

#### 9.某文件系统采用多级索引的方式组织文件的数据存放，假定在文件的 node中设有13个地址项，其中直接索引10项，一次间接索引项1项，二次间接索引项1项，三次间接
索引项1项。数据块的大小为4KB，磁盘地址用4B表示，试问:
1）这个文件系统允许的最大文件长度是多少？
2）一个2GB大小的文件，在这个文件系统中实际占用多少空间？

#### 11.假定一个盘组共有100个柱面，每个柱面上有16个磁道，每个磁道分成4个扇区。
1）整个磁盘空间共有多少个存储块？
2）若用字长32位的单元来构造位示图，共需要多少个字？
3）位示图中第18个字的第16位对应的块号是多少？

#### 12.文件采用多重索引结构搜索文件内容。设块长为512B，每个块号长2B，若不考虑逻辑块号在物理块中所占的位置，分别计算二级索引和三级索引时可寻址的文件最大长度

#### 13.【2012统考真题】某文件系统空间的最大容量为4TB（1TB=24B），以磁盘块为基本分配单位。磁盘块大小为1KB.文件控制块（FCB）包含一个512B的索引表区。请回答下列问题:

1）假设索引表区仅采用直接索引结构，索引表区存放文件占用的磁盘块号，索引表项中块号最少占多少字节？可支持的单个文件的最大长度是多少字节？
2）假设索引表区采用如下结构:第0~7字节采用<起始块号，块数>格式表示文件创建时预分配的连续存储空间。其中起始块号占6B，块数占2B，剩余504B采用直接索引结构，一个索引项占6B，则可支持的单个文件的最大长度是多少字节？为使单个文件的长度达到最大，请指出起始块号和块数分别所占字节数的合理值并说明理由

#### 15.【2014统考真题】文件F由200条记录组成，记录从1开始编号。用户打开文件后，欲将内存中的一条记录插入文件F中，作为其第30条记录。请回答下列问题，并说明理由。

1）若文件系统采用连续分配方式，每个磁盘块存放一条记录，文件存储区域前后均有足够的空闲磁盘空间，则完成上述插入操作最少需要访问多少次磁盘块？F的文件控制块内容会发生哪些改变？

2）若文件系统采用链接分配方式，每个磁盘块存放一条记录和一个链接指针，则完成上述插入操作需要访问多少次磁盘块？若每个存储块大小为1KB，其中4B存放链接指针，则该文件系统支持的文件最大长度是多少？