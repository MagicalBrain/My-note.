# 4.1 文件系统基础

## 文件的概念

## 逻辑结构

## 目录结构

## 文件共享

## 文件保护

# 4.2 文件系统实现

## 文件目录层次结构

```flow
    st=>start: 用户查看文件F的内容
    e=>end: 结束
    op=>operation: 对操作系统发出命令（第一层 用户调用接口）
    
    op1=>operation: 在目录中查找文件F的索引信息（第二层 文件目录系统）
    op2=>operation: 查看用户是否有权限（第三层存取控制验证）
    op3=>operation: 通过验证，开始寻址，得到逻辑地址（第四层 逻辑文件系统与文件信息缓冲区）
    op4=>operation: 逻辑地址转换为物理地址（第五层 物理文件系统）

    st->op->op1->op2->op3->op4->e
```

## 目录实现

### 线性表

#### 基本操作：

##### 创建新文件

```flow
St=>start: 创建新文件

op1=>operation: 搜索目录表是否有同名
op2=>operation: 目录表后增加一目录项

St->op1->op2
```

##### 删除文件

```flow
St=>start: 删除文件

op1=>operation: 据给定文件名搜索目录表
op2=>operation: 找到后释放其内存空间
op3=>operation: 目录项重用

St->op1->op2->op3
```

**重用目录项**

两种方法：
1. 标记为不再使用
2. 添加到空闲目录项表里
3. 将最后一个目录项添加到此空闲目录项，以减少目录表的长度

优点：
实现简单

缺点：
慢，费时（如采用链表会快一点）

结合数据结构相关内容

### 哈希表

文件名根据哈希函数得到一个键值

优点：
查找快速

缺点：
需要处理冲突

结合数据结构相关内容

## 文件实现

### 文件分配方式

#### 连续分配方式

优点：
实现简单，速度快

缺点：
文件长度不宜动态增加，只适合定长的文件

#### 链接分配方式

优点：
1. 对文件操作方便
2. 无须事先是到文件的大小

解决了连续分配的外部碎片的问题和文件大小管理问题

**隐式链接**



**显式链接**



#### 索引分配方式

索引块的大小与系统开销问题的解决方案：

**链接方案**

**多层索引**

**混合索引（高频考点、难点）**

三种分配方式的比较

||访问第n条记录|优点|

### 文件存储空间管理

#### 文件存储器空间的划分与初始化

#### 文件存储器空间管理

#### 存储空间管理方法

##### 空闲表法

# 4.3 磁盘组织与管理

可与计算机组成原理结合来看

## 磁盘结构

**磁头**

**磁道**

**扇区**
又称之为盘块

**磁盘地址**


|  柱面号  | 盘面号   | 扇区号（块号）   |
| --- | --- | --- |

## 磁盘分类

按不同标准可分

### 按磁头分

**固定头磁盘**

**活动头磁盘**

### 按磁盘是否固定

**固定磁盘**

**可换盘磁盘**

## 磁盘读写时间的计算

即磁盘寻块时间

### 寻找时间

### 延迟时间

### 传输时间

是由磁盘本身性质决定的，不能通过采取措施减少（除非换一个更快的磁盘）

## 磁盘调度算法

### 先来先服务（FCFS）

### 最短寻找时间优先（SSTF）

### 扫描算法（SCAN）

## 减少延迟时间

**交替编号**

**错位命名**

## 磁盘管理

### 磁盘初始化

```flow
St=>start: 初始化

op1=>operation: 低级格式化（物理分区），分扇区
op2=>operation: 给柱面分区（即C盘，D盘……）
op3=>operation: 对物理分区逻辑格式化（创建文件系统）

St->op1->op2->op3
```

### 引导块

就是我们装系统后，开机进入系统需要的

**初始化程序**

开机需要运行一个初始化程序（自举程序），有了这个才能正常开机
通常保存在ROM，但完整的在磁盘的启动块上（防止被修改）

**系统磁盘**
又称之为启动磁盘：拥有启动分区的磁盘

### 坏块

一种硬件故障，操作系统不能修复

#### 坏块的处理

实质就是采用某种机制使操作系统不去使用坏块

**手动处理**
仅适用于简单磁盘

**扇区备用**
适用于复杂磁盘