# 灰度图（2D）和深度图（3D）结合进行物体识别

[toc]

# 参考论文一

## 参考文献

**3-D Object Recognition Based on Integration of Range Image and Gray-scale Image**
Manabu Hashimoto and Kazuhiko Sumi Industrial Electronics and Systems Laboratory Mitsubishi Electric Corporation Amagasaki-city, 661-8661 Japan
hasimoto@sen.sdl.melco.co.jp

## 基本原理

1. 利用深度图获取目标所在的平面
2. 利用灰度图获取目标的精确位置

## 如何获取深度图

使用双目相机

投影仪投射随机点到区域（为了克服有无纹理的困难）

用拍照获得的灰度图生成深度图

## 深度图如何提取出目标

用**模板匹配技术**对二值化后的深度图进行处理，从而提取出目标。

深度图的模板？模板是在物体的俯视角度自动生成的？还需要微调，怎么微调？可以像点云那样弄吗？


## 如何获取灰度图

使用生成深度图的灰度图？

## 通过灰度图获取目标物体的精确位置

获取高分辨率的灰度图？分辨率不都那样吗

使用轮廓模板匹配技术来进行匹配。

## 整个方法的流程



轮廓模板有一个一维的数据结构（$C = (I_k, J_k, G_k)$？），类似如下的定义。

```cpp
class Contour {
    double I, J;    //轮廓点坐标
    int G;      //坐标点梯度所确定的方向码
};

class ContourTemplate {
    vector<Contour> data;
};
```

$E(i, j)$

正如上面提到那样，高速模板匹配是通过匹配轮廓点像素和一维模板来实现的。

这种方法适合高精度的模式校准？因为物体的轮廓能够提供确定精确位置的信息。

更为重要的是，根据最大相似度是否达到模板匹配的阈值来判断每一个候选目标物是真还是假。

如果我们尝试直接使用模板匹配技术从灰度图而不是深度图中提取候选目标物，那么由于“假”的边缘分布过多将会导致“假”的待选目标物太多。
因此使用深度图提取候选目标物将会使得算法更为稳定。

# 目前的思路

先弄个简单的：
先在2D图里抠出被识别的物体，然后去3D图里获取质心的坐标。

这个简单的思路会导致一个问题：
如果有多个物体，那么获取质心的时候，这多个物体会被当成一个整体。这样获取的质心是这由多个物体组成的整体的质心，而不是单个物体的质心，这样的质心是没有意义的，无法进行抓取的。

完善了一下思路：
1. 先在2D图里抠出被识别的物体；
2. 去3D图里获取被识别出来的物体其所包含的所有点的坐标加入到点云
3. 对识别出来的物体的点云进行分割
4. 计算分割出来的物体的质心的坐标。

## 2D抠图的流程

2D的处理主要使用opencv。

### 图像形态学处理

包括：腐蚀（erode）、膨胀、开关、顶帽底帽操作等。

### 边缘检测

目前使用的是Canny算法来检测边缘

### 提取轮廓并画出

findcontours

drawcontours

### 轮廓拟合

尝试进行轮廓拟合，因为目前此算法识别的对象都是比较规则的物体。
1. 通过`cv::minAreaRect()`找到最小矩形的四个角点
2. 给这四个角点连线（计算点的坐标并加进contours里）
3. 接下面的寻找最大连通图

### 寻找最大连通图

findC

## 3D处理流程

去到深度图获取点的坐标

### 点云分割

区域生长分割出来后常常会把多个木块看作一个，也就是说效果不是太好。

如果2D部分搞好的话，下一步试试LCCP

### 计算质心
