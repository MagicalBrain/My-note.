# 三维重建

## 基本流程

```sequence
标定->投影: 
投影-->解码: 
解码->重建: 
```

## 标定

### 选择标定板

[标定板的种类与优缺点](https://zhuanlan.zhihu.com/p/353316030)



### 图像采集

这里貌似没有什么技术含量的东西，主要就是调参数的经验。

采集前调节好相机、投影仪的焦距、曝光等参数，确保获取的图像清晰。
焦距一般是事先调好的后面不应再改的。而曝光要根据实际环境的光照情况来进行调整。
采集过程中要确保标定板处于==重合采集区域==中。
同时调整多种姿态，如水平、左倾、右倾、前倾、后倾等。倾斜角度也不能太小。采集图像数量一般不小于15 组。

比较值得一提的就是郑利洋实现了一个根据实时曝光自动检测触发曝光的功能。

什么是重合采集区域？
实时曝光？
触发曝光？

### 角点识别

寻找角点是为了获取标定板角点在相机图像坐标中的像素坐标。
对于相机设备：棋盘格标定板通过findChessboardCorners函数可
以获得角点信息，获取成功后，还需要调用cornerSubPix进一步提高角度位置的精度。
圆标定板通过findCirclesGrid函数获取角点信息。
对于投影仪：通过解编码可以获取角点在投影仪视野中的像素坐标。

需要注意的是投影仪的投射范围小于相机能拍到的范围，这就是为什么有时候标定板相机看得见而仍然无法识别到角点的原因。

findChessboardCorners
cornerSubPix
findCirclesGrid
源码？

### 相机标定

找到了标定板角点的像素坐标，同时也知道了标定板角点在世界坐标中的相对位置。
我们可以通过数学方法（参考张正友论文）计算出相机（或投影仪）的内参矩阵$K$和畸变参数$[𝑘_1, 𝑘_2, 𝑝_1, 𝑝_2, 𝑘_3]$。(什么是相机的内参和畸变参数？)
OpenCV 已经将标定计算封装在calibrateCamera接口中，我们直接调用即可。
另外calibrateCamera 接口可以获取每组图像的标定误差。首次标定完成后，我们通过自己设定的误差阈值筛选掉误差较大的图像组，再重新标定可以获得更高的标定精度。

相机标定的原理？
calibrateCamera的源码？

### 立体标定

单个相机（或投影仪）标定完成后，我们还需要进一步做立体标定。立体标定是为了建立左、右相机（或投影仪）间的空间关系。通过OpenCV 的stereoCalibrate接口可以完成立体标定过程，并获得左相机坐标到右相机（或投影仪）间的旋转矩阵$R$ 和平移矩阵$𝑡$。

立体标定的原理？
stereoCalibrate的源码？

## 投影

根据三维相机设计拍摄面积选择合适的条纹周期（条纹数）：70，64，59
采用**4步相移法**生成投影条纹

什么是4步相移法？

## 解码

1. 使用外差法求解包裹相位
2. 相位展开
3. 根据相位和像素对应关系求解像素坐标

## 重建

1. 以左相机坐标为基准建立世界坐标
2. 左右相机联立方程
3. 求解方程，解得每个像素的XYZ坐标

