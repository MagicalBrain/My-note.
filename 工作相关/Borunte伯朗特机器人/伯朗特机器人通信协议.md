[toc]

# 华成手控系统远程监控通信协议

PC 与与 Borunte 交互时，使用的是下面格式的通信协议

所有的通信帧都为 JSON 格式 通讯类型分为查询和发送两种类型。

## 1. 查询数据格式 
发送如下 JSON 帧 
```javascript
{
"dsID":"HCRemoteMonitor", //唯一标识 
"cmdType": "query",
"queryAddr":["version", "curMold"] //地址数组
}
```
回复如下 JSON 帧 
```javascript
{
"dsID":"HCRemoteMonitor", //唯一标识 
"cmdType": "queryEcho", 
"queryData":["v1.1", "default"] //地址数组
}
```

指令解释:
1、发送时在 queryAddr 一栏可以填写多个地址表，对应查询多个地址的信息; 
2、接收时，queryData 一栏会返回与 queryAddr 种地址表一一对应的内容; 上述指令表示 版本信息 v1.1，当前模号 default

## 2. 地址表

1. version:版本号
2. curMold:当前模号
3. counterList:计数器 ID 列表:["0","2","5"]
4. counter-n:计数器信息:计数器[id][T:0][C:0]:名称
5. curMode:当前模式
6. boardIONum:IO 板总数
7. input-n:32 位输入状态
8. output-n:32 位输出状态
9. axisNum:轴总数
10. axis-n:轴位置
11. world-n:世界坐标轴位置
12. curAlarm:当前报警信息
13. curCycle:当前周期
14. lastCycle:上模周期
15. machineName:机器名称
16. curTorque:当前扭矩
17. curSpeed:当前速度
18. curAccount:当前用户
19. origin:原点状态
20. moldList:模号列表:["A1","A2","A5"]

## 3. 命令数据格式 

发送如下 JSON 帧 
```javascript
{
"dsID":"HCRemoteMonitor", //唯一标识 
"cmdType": "command",
"cmdData":["cmd", "d1","d2"...]
}
```

回复如下 JSON 帧 
```javascript
{
//命令数据
"dsID":"HCRemoteMonitor", //唯一标识
"cmdType": "cmdEcho",
"cmdReply":["cmd", "r1","r2"...] //命令回复 "r1":"ok","err"
}
```

指令解释
1、 cmdData 中 cmd 为下列命令表中的某些字段，d1,d2 为对应字段(算子)的输入
2、 cmdReply 中，cmd 应和 cmdData 中的 cmd 相同，并回复执行结果 r1-ok r2-err?; 

## 4. 命令表

1. actionStop:立即停止当前动作(启动从头开始)
2. actionPause:暂停当前动作(启动从当前步开始)
3. actionSingleCycle :进入单循环
4. startButton:启动按键
5. stopButton:停止按键
6. switchMold:切换模号 "d1":模号
7. modifyCounter:修改计数器 "d1":计数器 ID，"d2":当前值(-1，为不修改)，"d3":目标值(-1，为不修改)
8. modifyOutput:修改输出点状态 "d1":输出板 ID(0~3:IO 板，4~6:M 值，7:EUIO)， "d2":输出点 ID，"d3":输出状态(0:OFF，1:ON)
9. clearAlarm:清除报警
10. clearAlarmContinue:清除报警并继续自动运行(自动运行状态下)
11. modifyStackData:堆叠修改 "d1":sID, "d2-d4":堆叠间隔 x、y、z，"d5-d7":计数 x、y、z 
12. modifyGSPD:全局速度修改 "d1":速度
13. rewriteData:数据修改 "d1":addrs,"d2":value,"d3":savable
14. rewriteDataList:数据块修改 "d1":addrs,"d2":length,"d3":savable,"d4","d5","d6","d7",......

## 5. 运用例子

1. 远程发送要运动的点位可以发如下命令: 

```javascript
{
"dsID":"HCRemoteMonitor",
"cmdType": "command",
"cmdData":["rewriteDataList", "800","6","0", "10.123", "20.000","3.500", "45.000", "30.987", "40.678"] 
}
```

```javascript 
{
"dsID":"HCRemoteMonitor",
"cmdType": "command",
"cmdData":["rewriteData", "800", "10", "0"]
} ```

2. 远程查询状态例程: 发送:

```javascript
{
"dsID":"HCRemoteMonitor", 
"cmdType": "query", 
"queryAddr":["version", "curMold"]
}
```

回复: 
```javascript 
{
"dsID":"HCRemoteMonitor", 
"cmdType": "queryEcho",
//查询版本号和当前模号
"queryData":["v1.1", "default"]
}
```

3.远程控制示例 发送
```javascript
{
"dsID":"HCRemoteMonitor",
"cmdType": "command",
"cmdData":["stopButton",] //停止当前运行的程序
}
```
回复如下 JSON 帧 
```javascript
{
"dsID":"HCRemoteMonitor", 
"cmdType": "cmdEcho", 
"cmdReply":["cmd", "r1","r2"...] //命令回复
}
```

发送数据
```javascript
{
    "dsID":"HCRemoteMonitor",
    "cmdType": "command",
    "cmdData":["rewriteData", "800", "22710", "0"]
}      
{
    "dsID":"HCRemoteMonitor",
    "cmdType": "command",
 "cmdData":["rewriteData", "801", "834740", "0"]
}      
{
    "dsID":"HCRemoteMonitor",
    "cmdType": "command",
"cmdData":["rewriteData", "802", "834740", "0"]
}   
{
    "dsID":"HCRemoteMonitor",
    "cmdType": "command",
  "cmdData":["rewriteData", "803", "95456", "0"]
}      
{
    "dsID":"HCRemoteMonitor",
    "cmdType": "command",
"cmdData":["rewriteData", "804", "2458", "0"]
}  
{
    "dsID":"HCRemoteMonitor",
    "cmdType": "command",
"cmdData":["rewriteData", "805", "-0065", "0"]
}
```
  
修改io状态
```javascript
{
    "dsID":"HCRemoteMonitor", 
    "cmdType": "command",
    "cmdData":["modifyOutput","0","6","0"]
}
```

查询io状态
```javascript
{
    "dsID":"HCRemoteMonitor",
    "cmdType": "query",
    "queryAddr":["version", "output-0"]
}
```

视觉配合流程：机械手需要数据时，发一个IO输出信号（接到输入点，用来判断数据是否传输完毕），视觉拍照传输数据，数据传输完毕关闭掉输出点（提示数据传输完毕），
机械手继续走位。
（检测io输出信号可以硬件接到相机，也可以实时检测io输出状态）

```javascript
{
"dsID":"HCRemoteMonitor",
"cmdType":"queryEcho",
"queryData":["Robot-1.4.1master_1.0.1_HC_S6-0.1-8.1\u00008\u00006\u0000\u0000\u0000","18"]
}
```

```javascript
{
"dsID":"HCRemoteMonitor",
"cmdType":"queryEcho",
"queryData":["Robot-1.5.6-master_1.0.1_lau_cn_HC_S6-0.1-9.6_1\u00008\u00006\u0000","6.107"]
}
```

