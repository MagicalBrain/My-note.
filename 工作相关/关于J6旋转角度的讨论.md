# 关于J6旋转角度的讨论

## level 1

机器人末端在夹取的时候没有方向，仅要求线不缠绕。

### sdp大佬的代码

他的代码是基于傲博机器人的（Aubo）的

```cpp
// 他给机器人关节加了限制，限制在 正负173 之间，
// 因为即使机器人手册上写着活动范围在 正负180;
// 而实际运行中，正负174 再多一点就会触发警报使得机器人停止
if (target_point.jointpos[5] > (M_PI * 7.0f / 180.0f))
{
    target_point.jointpos[5] = abs(refer_point.jointpos[5] - target_point.jointpos[5] + M_PI) >
        abs(refer_point.jointpos[5] - target_point.jointpos[5) ? 
        target_point.jointpos[5]
        : 
        target_point.jointpos[5] - M_PI;
}
else if(target_point.jointpos[5] < - (M_PI * 7.0f / 180.0f))
{
    target_point.jointpos[5] = abs(refer_point.jointpos[5] - target_point.jointpos[5] -M_PI) >
        abs(refer_point.jointpos[5] - target_point.jointpos[5]) ? 
        target_point.jointpos[5] 
        : 
        target_point.jointpos[5] + M_PI;
}
```

## level 2

要求末端运行是要有方向的，且线不能缠绕。

sdp提供的思路：
在运行路径中插入一个路径点，使得其关节坐标均为前后点位关节坐标的平均值。（其实就是插值处理一下）

我自己在sdp提供的思路下的实现：

```cpp
    /*********************************************************
    * @brief      解决无序抓取中的定方向放置问题
    * @details
    * @author    Ruilin Huang
    * @date      2021/10/28
    ********************************************************/
    wayPoint_S tmp = target_point;
    tmp.jointpos[5] = (target_point.jointpos[5] + refer_point.jointpos[5]) / 2.0;
    if (use_movej == 0)
    {
        
        status = rs_move_line(device_handle_, tmp.jointpos, true);
        if (status != RS_SUCC)
        {
            HY_LOG_SEV(error) << "failed to execute move command, error " << status;
            //is_robot_moving_ = false;
            return HY_FAIL_UNDEFINE;
        }

        status = rs_move_line(device_handle_, target_point.jointpos, true);
    }
    else
    {
        status = rs_move_joint(device_handle_, tmp.jointpos, true);
        if (status != RS_SUCC)
        {
            HY_LOG_SEV(error) << "failed to execute move command, error " << status;
            //is_robot_moving_ = false;
            return HY_FAIL_UNDEFINE;
        }

        status = rs_move_joint(device_handle_, target_point.jointpos, true);
    }

    
    if (status != RS_SUCC)
    {
        HY_LOG_SEV(error) << "failed to execute move command, error " << status;
        //is_robot_moving_ = false;
        return HY_FAIL_UNDEFINE;
    }

    HY_LOG_SEV(info) << "move to " << loc << " finish";
    return HY_SUCESS;
```
