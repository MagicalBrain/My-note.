# OpenCV提取物体的轮廓

## 使用findContours函数寻找轮廓

### findContours函数声明

```cpp
void cv::findContours(
    cv::InputArray image,
    cv::OutputArray contours,
    cv::OutputArray hierarchy,
    int mode,
    int method,
    cv::Point offset = cv::Point()
)

void cv::findContours(
    cv::InputArray image,
    cv::OutputArray contours,
    int mode,
    int method,
    cv::Point offset = cv::Point()
)
```

**image**：
为输入图像，必须为8位单通道图像，且应该已经被转换为二值图像。
`cv::findContours`处理后会修改输入图像。

**contours**：
是一个vector容器，其元素类型应为轮廓，即`std::vector<cv::Point>`。

**hierarchy**（可选 optional）：
如果给定该参数，将输出所有轮廓的树结构。
这是一个`std::vector<cv::Vec4i>`类型，即一个vector里装的元素是`cv::Vec4i`类型

**mode**：
设定提取轮廓的方式，有4种可选
1. cv::RETR_EXTERNAL
   1. 只检索最外部的轮廓
   2. 分析：简单粗暴只适合比较简单的物体轮廓提取
2. cv::RETR_LIST
   1. 检索所有轮廓并保存到表中
   2. 分析：可以方便地获取所有提取的轮廓，但是却无法获知轮廓之间的关系
3. cv::RETR_CCOMP
   1. 检索所有轮廓并组织成两层结构：
      1. 顶层时最外部的轮廓
      2. 第二层边界时内部孔洞的轮廓
   2. 分析：可以简单、快速地获取最外部的轮廓和内部的轮廓。
4. cv::RETR_TREE
   1. 检索所有轮廓并建立起树状结构。从根节点到叶子节点，是最外部的轮廓到内部的轮廓。
   2. 分析：可以获取所有轮廓之间的包含关系，但是遍历轮廓较麻烦（树的遍历效率较低）

**method**：
设定轮廓表达的方式，有三种方法可选
1. cv::CHAIN_APPROX_NONE
   1. 将轮廓编码中的所有点转换为点。这一操作会产生大量的点，不会减少轮廓提取后返回的点的数量。
2. cv::CHAIN_APPROX_SIMPLE
   1. 压缩水平、垂直、斜的部分为一个点。将会大大减少返回的点（例如：矩形只保留四个角点）
3. cv::CHAIN_APPROX_TC89L1 OR cv::CHAIN_APPROX_TC89KCOS
   1. 使用**Teh-Chin链**逼近算法，用于减少返回的点的数量

### findContours函数的简单用法

```cpp
findContours(output, countersTemp, cv::RETR_EXTERNAL, cv::CHAIN_APPROX_NONE); 
```

### findContourd函数获取的cv::RETR_TREE分析

```bash
[1, -1, -1, -1]
[3, 0, 2, -1]
[-1, -1, -1, 1]
[5, 1, 4, -1]
[-1, -1, -1, 3]
[6, 3, -1, -1]
[9, 5, 7, -1]
[8, -1, -1, 6]
[-1, 7, -1, 6]
[10, 6, -1, -1]
[18, 9, 11, -1]
[17, -1, 12, 10]
[13, -1, -1, 11]
[15, 12, 14, 11]
[-1, -1, -1, 13]
[16, 13, -1, 11]
[-1, 15, -1, 11]
[-1, 11, -1, 10]
[27, 10, 19, -1]
[22, -1, 20, 18]
[-1, -1, 21, 19]
[-1, -1, -1, 20]
[23, 19, -1, 18]
[24, 22, -1, 18]
[26, 23, 25, 18]
[-1, -1, -1, 24]
[-1, 24, -1, 18]
[28, 18, -1, -1]
[29, 27, -1, -1]
[30, 28, -1, -1]
[31, 29, -1, -1]
[32, 30, -1, -1]
[33, 31, -1, -1]
[34, 32, -1, -1]
[35, 33, -1, -1]
[36, 34, -1, -1]
[37, 35, -1, -1]
[39, 36, 38, -1]
[-1, -1, -1, 37]
[40, 37, -1, -1]
[42, 39, 41, -1]
[-1, -1, -1, 40]
[43, 40, -1, -1]
[44, 42, -1, -1]
[45, 43, -1, -1]
[46, 44, -1, -1]
[47, 45, -1, -1]
[48, 46, -1, -1]
[49, 47, -1, -1]
[51, 48, 50, -1]
[-1, -1, -1, 49]
[52, 49, -1, -1]
[53, 51, -1, -1]
[54, 52, -1, -1]
[55, 53, -1, -1]
[56, 54, -1, -1]
[63, 55, 57, -1]
[58, -1, -1, 56]
[-1, 57, 59, 56]
[-1, -1, 60, 58]
[61, -1, -1, 59]
[62, 60, -1, 59]
[-1, 61, -1, 59]
[64, 56, -1, -1]
[65, 63, -1, -1]
[66, 64, -1, -1]
[68, 65, 67, -1]
[-1, -1, -1, 66]
[76, 66, 69, -1]
[70, -1, -1, 68]
[71, 69, -1, 68]
[72, 70, -1, 68]
[73, 71, -1, 68]
[74, 72, -1, 68]
[75, 73, -1, 68]
[-1, 74, -1, 68]
[77, 68, -1, -1]
[79, 76, 78, -1]
[-1, -1, -1, 77]
[80, 77, -1, -1]
[81, 79, -1, -1]
[82, 80, -1, -1]
[83, 81, -1, -1]
[84, 82, -1, -1]
[85, 83, -1, -1]
[86, 84, -1, -1]
[89, 85, 87, -1]
[88, -1, -1, 86]
[-1, 87, -1, 86]
[91, 86, 90, -1]
[-1, -1, -1, 89]
[-1, 89, -1, -1]
```

## 使用drawContours函数绘制轮廓

### drawContours函数声明

```cpp
void cv::drawContours(
    cv::InputArray image,
    cv::InputArray contours,
    int contourIdx, 
    const cv::Scalar & color,
    int thickness = 1,
    int lineType = 8,
    cv::OutputArray hierarchy = noArray(),
    int maxLevel = INT_MAX,
    cv::Point offset = cv::Point()
)
```

**image**：
待绘制轮廓的图像

**contours**：
要绘制的轮廓，其元素类型应为轮廓，即`std::vector<cv::Point>`。

**contourIdx**
用于设置是否绘制所有轮廓。
`contourIdx > 0`则对应的轮廓会被绘制，`contourIdx < 0`，则所有轮廓都会被绘制出来。

**hierarchy**（可选 optional）：
如果给定该参数，将输出所有轮廓的树结构。
