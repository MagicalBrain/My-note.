# 通用形态学操作

在处理二值图像或者像素只可能是开（>0）或关（=0）的图像掩膜时，膨胀腐蚀操作就够用了。但是在处理灰度图和彩色图时，还需要一些其它操作。

## 开操作

开，闭操作其实是膨胀腐蚀操作的简单组合。
开操作是先腐蚀再膨胀。
结果和腐蚀的结果相近。

## 闭操作

闭操作是先膨胀再腐蚀。
结果和膨胀的结果相近。

## 形态学梯度(Morphological Gradient)

表达式为：
$$gradient(src) = dilate(src) - erode(src)$$

梯度操作的结果（扩张亮域）减腐蚀操作的结果（缩减亮域）产生了源图像中目标的边缘。

主要作用是标出图像中明亮变化明显的部分（边缘）。

## 顶帽操作

用于显示与其领域相比更亮的区域

表达式：
$$TopHat(src) = src - open(src)$$

## 底帽操作

用于显示与其领域相比更暗的区域

表达式：
$$BlackHat(src) = close(src) - src$$

## cv::morphologyEx()函数

这些操作可以通过`cv::morphologyEx()`来实现

```cpp
void cv::morphologyEx(
    cv::InputArray src,     //Input image
    cv::OutputArrat dst,    //Result image
    int op,     //Operator (e.g. cv::MOP_OPEN)
    cv::InputArray  element,    //Structuring, a cv::Mat()
    cv::Point anchor = cv::Point(-1,-1),    //Location of anchor point
    int iterations = 1,     // Number of times to apply
    int borderType =cv::BORDER_CONSTANT,    // Border extrapolation borderValue
    const cv::Scalar& = cv::morphologyDefaultBorderValue()
);
```

注意：
对于开闭操作，迭代次数iterations指的是其所包含的腐蚀、膨胀分别进行的次数。

参数相比于`erode`和`dilate`，就多了个`int op`参数。

op用于设置函数进行的操作，可选的值有：

|操作值|形态学操作|是否需要临时图像|
|:--:|:--:|:--:|
|cv::MOP_OPEN|开|否|
|cv::MOP_CLOSE|关|否|
|cv::MOP_GRADIENT|形态学梯度|总是需要|
|cv::MOP_TOPHAT|顶帽操作|就地调用需要(src = dst)|
|cv::MOP_BLACKHAT|底帽操作|就地调用需要(src = dst)|
